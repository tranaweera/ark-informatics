<?xml version="1.0"?>
<Schema name="Casegenix">

<!-- Assessment Performance Report -->
    <Cube name="ReportBio">
        <View alias="ReportBio">
            <SQL dialect="generic">
                    SELECT "NAME","SURNAME","DOB","SEX","EMAIL","PATIENTID","PATIENTKEY","BIOSPECIMENID"
                         from ix_patient 
                         LEFT JOIN
                         (select lower("FIRSTNAME") AS "NAME","PATIENTKEY" AS "PKEY" from ix_patient WHERE "DELETED" = 0) AS PatientName
                         ON ix_patient."PATIENTKEY"= PatientName."PKEY"
                         INNER JOIN
                         (select "BIOSPECIMENID","PATIENTKEY" AS "BIOPATIENT" from ix_biospecimen WHERE "DELETED"='0') AS Biospecimen ON
                         ix_patient."PATIENTKEY" = Biospecimen."BIOPATIENT"
                    WHERE ix_patient."DELETED" = 0 AND PatientName."NAME" LIKE 'patient_name%'
            </SQL>
        </View>

	<Dimension name="Patients">
            <Hierarchy hasAll="true" allMemberName="All Patients">
                <Level name="Patient ID" column="PATIENTID" uniqueMembers="true"/>
                <Level name="Biospecimen Key" column="BIOSPECIMENID" uniqueMembers="true">
                    <Property name="First Name" column="NAME"/>
                    <Property name="Surname" column="SURNAME"/>
                    <Property name="Date of Birth" column="DOB"/>
                    <Property name="Sex" column="SEX"/>
                    <Property name="Email" column="EMAIL"/>
                </Level>
            </Hierarchy>
        </Dimension>
		
	<Measure name="Number of patients" column="BIOSPECIMENID" aggregator="count"/>
    </Cube> 
</Schema>